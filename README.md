# 構文解析の本

アスキードワンゴで出版予定（2020年中に出すのが目標）の構文解析本に関するリポジトリ。とりあえずGitBookの形式で書き始める。
でも、gitbook-cliがもうメンテされていないので、別の形式に移行した方がいいかもしれない。

## リポジトリの構成

```
./
  book.json // GitBookの設定ファイル
  package.json // npmの各種設定
  package-lock.json // package.jsonのロックファイル（Gemfile.lockみたいなもの）
  README.MD // このファイル
  SUMMARY.md // 章構成
  .gitignore // gitの管理対象から除外するパターンの列挙
```

## 書籍のビルド方法

1. npm install

* 依存ライブラリをインストールする

```
$ npm install
```

2. npm start

* GitBookによって、書籍をビルドし、プレビューができる状態にする

```
$ npm start // GitBookによるプレビュー
...
Starting server ...
Serving book on http://localhost:4000
```

## 趣旨

これまで、プログラミング言語処理系（インタプリタやコンパイラ）を作ることについて
は様々な本が出版されてきた。特に有名なのは

* 通称ドラゴンブック（邦題：コンパイラ―原理・技法・ツール）
* 通称タイガーブック（邦題：最新コンパイラ構成技法）

この２冊だと言える。他にも、コンパイラで有名な中田育男先生やアカデミアで有名な専門家が
書いたコンパイラの本は少なくない。

一方で、コンパイラやインタプリタの一部となるパーザ（構文解析器）については、非常に
文献が少ない。上記、ドラゴンブックやタイガーブックにて、そのアルゴリズムについて
一部触れられているものの、それ以外は言語作成の過程として多少の説明をする程度である。
英語の本として、構文解析というテーマについて網羅的に触れられているのは、
[Parsing Techniques 2nd Edition](http://dickgrune.com/Books/PTAPG_2nd_Edition/)
がほぼ唯一のものであると思われる。

このことには、構文解析が、1970代〜1980年代にかけて「解決した問題」と思われていた
ことが一因ではないかと思われる。しかしBryan Fordが発表したPackrat Parsing(2002)
やその理論的基礎をなすParsing Expression Grammar(2004)、再帰下降構文解析の新たな
地平を切り開いたLL(*)(2010)、Adaptive LL(*)(2014)、GLL Parsing(2010)など、
新しい構文解析アルゴリズムは近年も登場しており、構文解析は「解決した問題」とは
いえない。

今ここで、再び構文解析という世界に光をあて

* （非自然言語の）構文解析とはどのような作業なのか
* 構文解析にはどのようなアルゴリズムがあるのか
* 各構文解析アルゴリズムアルゴリズムの特徴と制限
 * 下向き構文解析（LL family）
 * 上向き構文解析（主にLR family）
 * その他
* 新しい構文解析アルゴリズム（2000年代以降）
 * GLL
 * LL(*)
 * Packrat Parsing(PEG)

といったトピックを扱う本を出版したいと考えている。本書を読むことを通じて、読者は

* 自分が行いたい作業にあった構文解析アルゴリズムを適切に選ぶことができる
* 必要に応じて、構文解析のテクニックを使い分けることができる
  * 手書きパーザ
  * パーザジェネレータ
  * パーザコンビネータ
* より柔軟な文法を組み立てることができる

ようになることが期待される。

## 作業期間

基本的に、

- Parsing Techniques 2nd Edition
- コンパイラー原理・技法・ツール

で解説されている内容に加えて最新の論文でしか触れられていない内容をも平易に解説し、かつ、実践
でどのように使えるかという内容も盛り込むるので、結構難産になることが予想される。

内容のおさらい・きちんとした理解：１ヶ月
各章：半月〜１ヶ月
レビュー：１ヶ月

計10ヶ月くらいの期間を予定している。

## 章立て（仮）



### 1. 構文解析の世界へようこそ

構文解析とはそもそも何か、歴史やよく知られている応用などに触れつつ説明をする。また、構文解析の
話をする上で、避けては通れない、「文法（grammar)」や「言語（language)」といった概念について
informalに説明する。必要に応じて後ろの章でより詳しく触れる。

以降の章の構成についてもこの章の最後に触れる。

### 2. 手書き構文解析器

構文解析を理解するにはまず手で書いてみること、ということで、まずは
手で構文解析器を書くための手順を説明する。構文解析を行う言語としては、

- トップレベル： (変数定義 | 関数定義)
- 変数定義： var x = expression
- 関数定義： function f(x, y, z) { ... }
- 式：
  - 条件分岐： if
  - 繰り返し： while
  - 足し算、引き算： +, -
  - 掛け算、割り算、剰余、*, /, %
  - 単項演算子： +, - 
  - 比較： <, <=, >, >=, ==, !=
  - 関数呼び出し： f(e1, e2, ..., en)
  - グルーピング： (e):
  - 整数リテラル： (+|-)[0-9]+

という、関数定義と変数定義と、関数呼び出しと繰り返しの機能を持ったシンプルな言語FUNとする
 
#### 2.1. 字句解析器

手書き構文解析器ではほとんど必須になる字句解析について、説明する。基本的には前から
入力をスキャンしながら、最も長いトークンにマッチしたものを字句要素として切り出す
、といったことを実際にFUNの字句解析器を書く過程で学ぶ。

#### 2.2 再帰下降構文解析器

手書き構文解析器を使った場合の手法である再帰下降構文解析について、FUNの構文解析器を
書いて学ぶ。

#### 2.3 バックトラック型再帰下降構文解析器

通常の再帰下降構文解析器より実装が簡単だが効率が悪いため、近年まで実用化されなかった
バックトラック型再帰下降構文解析について、FUNの構文解析器を書いて学ぶ。

### 3. 構文解析アルゴリズム古今東西

現在までに知られている様々な構文解析アルゴリズムについて、簡単な特徴を列挙する。それぞれ、
詳しくは後続の章に書く。

- 演算子優先順位法
- LL法
  - LL(1)
  - LL(k)
  - LL(*)
  - ALL(*)
- LR
  - SLR
  - LALR
  - LR(0)
  - LR(1)
  - LR(k)
- Generalized Parsing
  - Generalized LL
  - Generalized LR
- PEG
  - Packrat Parsing

### 4. 文脈自由文法の世界

文脈自由文法を取り扱う構文解析アルゴリズムについて説明する。全てのアルゴリズムの解説に
おいて、FUN言語による構文解析器がどのようなものになるかを説明したい。

#### 4.1 演算子優先順位法

比較的シンプルな構文解析アルゴリズムである演算子優先順位文法について説明する。

#### 4.2 トップダウン構文解析アルゴリズム

トップダウン構文解析アルゴリズムとして代表的なLL(k)法と比較的近年になって確立された
LL(*)法(2010)、その発展形であるALL(*)について説明する。

#### 4.3  ボトムアップ構文解析アルゴリズム

ボトムアップ構文解析の代表であるLR法とその変種である、SLR法、LALAR法、LR法について説明する。

#### 4.4. Generalized Parsing

Generalized LL(GLL)とGeneralied LR(GLR)という、二つの、LL法とLR法を一般化した
アルゴリズムについて取り扱う。どちらの構文解析アルゴリズムも文脈自由文法全体を扱えるものである
ことを説明する。

### 5. 文脈自由文法を超えて

#### 5.1 Parsing Expression Grammar

#### 5.2 Packrat Parsing

#### 5.3 Parsing Expression GrammarとParser Combinator

### 6. 構文解析器生成系の世界

代表的な構文解析器生成系について、それぞれの特徴と制限について概観する。

- yacc(bison)
- JavaCC、
- ANTLRV4
- Coco/R

などについて紹介する予定である。

### 7. 現実の構文解析

既存の構文解析アルゴリズムではそのままではうまく取り扱えない諸問題について、何が
やっかいなのか、既存の処理系はどう解決しているかについて述べる

#### 7.1 字句要素が構文要素を含む文法

Ruby、Scala、Kotlinといった様々な言語が持つ、文字列補間（String Interpolation）
を例として解説する。

#### 7.2 インデント文法

Pythonのインデントによりプログラムの構造を表現する文法を例とする。

#### 7.3 ヒアドキュメント

Rubyのヒアドキュメントをパーズすることの難しさを說明する。

#### 7.4 改行終端可能文法

Ruby、Scala、Kotlin、Swift、Goなどの、改行によって文や式といった単位を終端
させることができる文法をパーズすることのめんどくささを說明する。

#### 7.x 他、思いついたら追加するかも

### 8. おわりに - 形式言語理論への招待 -

本書を締めくくる章であると同時に、構文解析の根底にある形式言語理論への導入
となることを意図している

### 付録

- 各構文解析器生成系によるFUN言語の構文解析器実装
- 7章のような拡張を各構文解析器生成系で扱う際のサンプルプログラム
- 参考文献

