# 第3章 文脈自由文法の世界

第3章では、JSONの構文解析器を記述することを通して、基本的な構文解析の方法を学びました。また、構文解析器についても、PEG型の構文解析器および字句解析器を使った二通りを作ってみることで、構文解析器といっても色々な書き方があるのがわかってもらえたのではないかと思います。

この第4章では、現代の構文解析を語る上で必須である、文脈自由文法という概念について学ぶことにします。「文脈自由文法」というと、一見、堅くて難しそうな印象を持つ方も多いかもしれません。しかし、一言で言ってしまえば、BNFをよりシンプルに、数学的に厳密にしただけのものであって、厳しい言葉から漂う程難解な概念ではありません。一方で、「文脈自由文法」という概念を習得することによるメリットは計り知れないものがあります。たとえば、それによって、正規表現で記述出来ないが文脈自由言語（BNFと表現力では等価）で記述出来る「言語」を知ることが出来ますし、文脈自由言語では記述不可能な「言語」について知ることも出来ます。

さて、文脈自由文法の世界に飛び込んで見ましょう。

## 3.1 BNFと文脈自由文法

さて、いきなり文脈自由文法の定義を大上段に示しても抽象的過ぎますので、まず、比較的皆様に馴染みがあるBNFを文脈自由文法を用いた記述に変換することで、文脈自由文法についての理解のとっかかりとしたいと思います。お題は、「カッコの釣り合いの取れた文字列」です。

たとえば、

```
()
(())
((()))
(((())))
```

はカッコの釣り合いの取れた文字列の例です。一方で、

```
)(
(()
(()())
```

はカッコの釣り合いの取れていない文字列の例です。このような言語をDyck（ディック）言語と呼び、これは文脈自由文法を特徴づける言語とされています。

このDyck言語の文法を擬似BNFで記述してみると以下のようになります。

```bnf
D = P
P = "(" P ")" | ""
```

Dが構文解析の際に最初に参照される記号で開始記号と呼ばれます。さて、このBNFを文脈自由文法のよる記述になおしていきましょう。そのためには、まず、一番外側にある"|"を消去する必要があります。同時に、"="は"→"に置き換えます。

さて、早速置き換えてみましょう。

```cfg
D → P
P → "(" P ")"
P → ""
```

あれ？同じ名前Pを持つ記号が二つ出てきてしまいましたね。実は、文脈自由文法（の標準的な表記法）では、同じ名前の規則は複数出てきても構いません。その場合の解釈は、とりあえずBNFで同名の規則を"|"でくくった場合と同じようなものと思ってもらって構いません。

次に、これはどちらでもいいといえばいいのですが、慣習上、文脈自由文法を表記する上では、空文字列はεと書くことになっているので、これも置き換えましょう。

```cfg
D → P
P → "(" P ")"
P → ε
```

さらに、文脈自由文法では、「文字列リテラル」というものはなく、そのまま列を表記しますから、"("も(のように表記します。すると、以下のようになります。

```cfg
D → P
P → ( P )
P → ε
```

このようにして変換して出来た文脈自由文法（の一つ）ですが、この中で、

```cfg
D → P
```

のような、→で区切られた右と左をあわせて、生成規則と呼びます。また、DやPを非終端記号と呼び、'('は終端記号と呼ばれます。このようにして見ていくと、文脈自由文法とは、

- 生成規則の0個以上の並び

からなっており、各生成規則は、

- 左辺は、一個の終端記号
- 右辺は、一個以上の終端記号または非終端記号の並び

からなっていることがわかります。しかし、このままでは曖昧ですから、文脈自由文法の数学的に厳密な定義を以下に示します。

```
G = (V, Σ, R, S) ただし、
1. Vは非終端記号の有限集合
2. Σは終端記号の有限集合で、Σ∩V＝∅
3. Sは開始記号で、S∈V
4. RはVから(V∪Σ)*への関係でかつ、∃w∈(V∪Σ)* : (S, W) ∈ Rが成り立つ
```

と、いきなりどばっと小難しい定義が出てきましたね。しかし、どれも、それほど難しい事を言っているわけではありません。まず、1.ですが、これは、ある文脈自由文法の中には、その中で使われる非終端記号の有限な集合が含まれている必要があるということです。先程の定義ですと、

```
V = {D, P}
```

となります。次に、2.ですが、これは、ある文脈自由文法の中で使われる終端記号（アルファベットとも呼ばれます）の有限集合です。Σ∩V＝∅という条件は、非終端記号と終端記号がオーバーラップしてはいけないというのを堅苦しく言い換えただけです。DYCK言語ですと、

```
Σ = {(,)}
```

となります。εは、終端記号ではないことに注意してください。文脈自由言語は、「文字列の並びの集合」を表したものであり、その最小単位は「1文字」であるため、空文字列は特別な取り扱いが必要になります。3.は、直観的には構文解析を始めるときに参照する非終端記号で、Vに含まれるもののいずれかです。DYCK言語の例だと、

```
S = D
```

となります。最後に、4.ですが、これは、直観的には、文脈自由文法とは、規則の集合であるという事を厳密に述べています。「関係」というのは、数学用語で言うところの二項関係の事ですが、これについては、おそらく別途解説が必要かと思うので、次の節で説明します。

ともあれ、文脈自由文法といっても、定義はこのように非常にシンプルなものです。とっつきやすくなった…でしょうか。たぶん、なっていないと思います。

「∃とか、*とか、「関係」とか、一体何なんだよー」

という声が聞こえて来そうです。というわけで、次の節では、文脈自由文法を理解するために、最低限必要な集合論上の道具立てについて解説することにします。

## 3.2 文脈自由文法のための集合論

偉そうに集合論上の道具立てと言いましたが、私自身、別段、集合論の専門家でも数学の専門家でもありませんので、サクっと済ませてしまおうと思います。