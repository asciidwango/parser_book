# 2. 身近な構文解析器

　さて、いよいよ、この章から、構文解析についての説明を始めたいと思います。この本を読んでいる読者の方は何らかの形で「構文解析器」または「構文解析」という用語に触れたことがあるのではないかと思います。この章では、JSON（JavaScript Object Notation）を例にして、構文解析というものについて説明していきます。

## 2.1 JSON（JavaScript Object Notation）

　JSONは、昨今のWebサービスにアクセスするためのAPIで非常に一般的に使われているデータフォーマットです。また、企業内サービス間で連携するときにも非常によく使われます。皆さんはおそらく、何らかの形でJSONに触れたことがあるのではないかと思います。

　JSONは、元々は、JavaScriptのサブセットとして、オブジェクトに関する部分だけを切り出したものでしたが、現在はECMAで標準化されており、色々な言語でJSONを扱うライブラリがあります。また、JSONはデータ交換用フォーマットの中でも非常にシンプルであるという特徴があり、そのシンプルさ故か、同じ言語でもJSONを扱うライブラリが乱立する程です。というウンチクはともかくとして、まずは、簡単なJSONのサンプルを見てみましょう。以下は、二つのキーを持ったJSONのサンプルです。

### 2.1.1 オブジェクト

```js
{
  "name":"Kota Mizushima",
  "age":36
}
```

　このJSONは、`name`という属性の値が`"Kota Mizushima"`という文字列であり、`age`という属性の値が`36`という数字であるオブジェクトであることを示しています。日本語で表現すると、名前が`Kota Mizushima`、年齢が`36`という人物一人分のデータを表していると考えることもできます。オブジェクトは、`{}`で囲まれた、`key:value`の対が`,`を区切り文字として続く形になります。

### 2.1.2 配列

　また、別の例として、以下のJSONを見てみます。

```js
{
  "kind":"Rectangle",
  "points": [
    {"x":0, "y":0},
    {"x":0, "y":100},
    {"x":100, "y":100},
    {"x":100, "y":0},
  ]
}
```

　このJSONは、種類が四角形で、それを構成する点が`(0, 0), (0, 100), (100, 100), (100, 0)`からなっているオブジェクトであることを示しています。JSONは要素として、配列を持つこともできます。配列は、`[]`で囲まれた要素の並びで、区切り文字は`,`です。

### 2.1.3 数値

　先ほどから既に出てきていますが、JSONの要素の一つに数値があります。数値は、

```js
1
10
100
1000
1.0
1.5
```

　のような形になっており、整数または小数です。ここで、JSONでの数値の解釈は特に規定されていない点に注意してください（IEEEの浮動小数点数である、といった規定はありません）。

### 2.1.4 文字列

　先ほどから出てきていますが、JSONの要素には文字列を含むことができます。

```js
"Hello, World"
"Kota Mizushima"
"hogehoge"
```

　のように、`""`で囲まれたのものが文字列となります。なお、JSONのオブジェクトのキーになれるのは文字列のみです。たとえば、以下はJavaScriptのオブジェクトとしては正しいですが、JSONのオブジェクトとしては正しくありません。

```js
{
  name:"Kota Mizushima",
  age:36
}
```

### 2.1.5 真偽値

　JSONの要素には、多くのプログラミング言語にある真偽値をを含むことができます。JSONの真偽値は以下のように、`true`または`false`の二通りです。

```js
true
false
```

### 2.1.6 null

　これも多くのプログラミング言語にある要素ですが、JSONの要素には`null`を含むことができます。多くのプログラミング言語のJSONライブラリでは、無効値に相当する値にマッピングされますが、JSONの仕様では`null`の解釈は定められていません。

### 2.1.7 JSONの全体像

　ここまでで、JSONで現れる要素について説明しましたが、JSONで使える要素は**これだけ**です。このシンプルさが、多くのプログラミング言語でJSONが使われる要因でもあるのでしょう。それはさておき、JSONで使える要素について改めて並べてみます。

- オブジェクト
- 配列
- 数値
- 文字列
- 真偽値
- null

　次の節では、このようなJSONの文法が、どのような形で表現できるかについて見ていきます。

### 2.1.8 JSONのBNF

　プログラミング言語の文法自体を表現する文法（メタ文法といいます）の一つに、BNF（Backus-Naur Form）があります。Fortranの開発者でもある、John Backusらが開発したこのメタ文法は、プログラミング言語の文法をはじめ、インターネット上でのメッセージ交換フォーマットなど、様々な文法を表現するのに使われています。早速、JSONのBNFを見てみることにしましょう。

```bnf
macro $sep(#K) = #K S;

JSON ::= S Object EOT;
Object ::= LBRACE RBRACE / LBRACE Members RBRACE;
Members ::= Pair (COMMA Pair)* ;
Pair ::= String COLON Value ;
Array ::= LBRACKET RBRACKET / LBRACKET Elements RBRACKET ;
Elements ::= Value (COMMA Value)* ;
Value ::= String / Number / Object / Array / TRUE / FALSE / NULL ;

CHAR ::= (!(["\\]) _) / "\\" [\\"/bfnrt] / "u" HEX HEX HEX HEX ;
HEX ::= [0-9a-fA-F] ;
INT ::= ("-")? ([1-9] [0-9]* / "0") ;
FRAC ::= "." [0-9]+ ;
EXP ::= E [0-9]+ ;
E ::= "e+" / "e-" / "E+" / "E-" / "e" / "E" ;
String ::= $sep("\"\"" / "\"" CHAR+ "\"");
Number ::= $sep(INT FRAC EXP / INT EXP / INT FRAC / INT);
TRUE ::= $sep("true") ;
FALSE ::= $sep("false");
NULL ::= $sep("null");
COMMA ::= $sep(",");
COLON ::= $sep(":");
LBRACE ::= $sep("{");
RBRACE ::= $sep("}");
LBRACKET ::= $sep("[");
RBRACKET ::= $sep("]");
S ::= ( [ \f\t\r\n]+
    / "/*" (!"*/" _)* "*/"
        / "//" (![\r\n] _)* [\r\n]
            )* ;
            EOT = !_ ;
```

　これまで説明したJSONの要素に比べて、見慣れない記号が出てきましたが、一つ一つ見て行きましょう。
